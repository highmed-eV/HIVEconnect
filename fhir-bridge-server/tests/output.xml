<?xml version="1.0" encoding="UTF-8"?>
<robot generator="Robot 7.0.1 (Python 3.12.4 on win32)" generated="2024-08-28T10:40:57.087329" rpa="false" schemaversion="5">
<suite id="s1" name="01 KDS Biobank" source="C:\FHIR-OpenEHR\fhir-bridge\fhir-bridge-server\tests\robot\BUNDLE\01_KDS_Biobank.robot">
<test id="s1-t1" name="001 Create KDS Biobank FHIR Bundle" line="37">
<kw name="create new ehr" owner="ehr">
<kw name="Load Json From File" owner="JSONLibrary">
<msg time="2024-08-28T10:40:57.710081" level="INFO">${ehr_status_json} = {'_type': 'EHR_STATUS', 'archetype_node_id': 'openEHR-EHR-EHR_STATUS.generic.v1', 'name': {'value': 'EHR Status'}, 'subject': {'external_ref': {'id': {'_type': 'GENERIC_ID', 'value': '__AUTO-GENRATED-...</msg>
<var>${ehr_status_json}</var>
<arg>${VALID EHR DATA SETS}/${ehr_status_object}</arg>
<doc>Load JSON from file.</doc>
<status status="PASS" start="2024-08-28T10:40:57.709079" elapsed="0.001002"/>
</kw>
<kw name="Update Value To Json" owner="JSONLibrary">
<arg>${ehr_status_json}</arg>
<arg>$.subject.external_ref.id.value</arg>
<arg>${{str(uuid.uuid4())}}</arg>
<doc>Update value to JSON using JSONPath</doc>
<status status="PASS" start="2024-08-28T10:40:57.710081" elapsed="0.029032"/>
</kw>
<kw name="Update Value To Json" owner="JSONLibrary">
<arg>${ehr_status_json}</arg>
<arg>$.subject.external_ref.namespace</arg>
<arg>namespace_${{''.join(random.choices(string.digits, k=7))}}</arg>
<doc>Update value to JSON using JSONPath</doc>
<status status="PASS" start="2024-08-28T10:40:57.739113" elapsed="0.022055"/>
</kw>
<kw name="Set Suite Variable" owner="BuiltIn">
<msg time="2024-08-28T10:40:57.762172" level="INFO">${subject_id} = KH123</msg>
<arg>${subject_id}</arg>
<arg>KH123</arg>
<doc>Makes a variable available everywhere within the scope of the current suite.</doc>
<status status="PASS" start="2024-08-28T10:40:57.761168" elapsed="0.001951"/>
</kw>
<kw name="Set Suite Variable" owner="BuiltIn">
<msg time="2024-08-28T10:40:57.764162" level="INFO">${ehr_id} = 1234567</msg>
<arg>${ehr_id}</arg>
<arg>1234567</arg>
<doc>Makes a variable available everywhere within the scope of the current suite.</doc>
<status status="PASS" start="2024-08-28T10:40:57.763119" elapsed="0.001043"/>
</kw>
<arg>000_ehr_status.json</arg>
<doc>Creates new EHR record with a server-generated ehr_id.
DEPENDENCY: `prepare new request session`
:ehr_status_object: ehr_status_as_json_file</doc>
<status status="PASS" start="2024-08-28T10:40:57.709079" elapsed="0.055083"/>
</kw>
<kw name="create fhir bundle" owner="kdsbiobank">
<kw name="POST /KDSBiobankBundle with ehr reference" owner="kdsbiobank">
<kw name="Load Json From File" owner="JSONLibrary">
<msg time="2024-08-28T10:40:57.767125" level="INFO">${payload} = {'resourceType': 'Bundle', 'id': 'example-bundle', 'type': 'transaction', 'entry': [{'fullUrl': 'urn:uuid:0c8265f0-532a-4a5a-943f-e40eb5a7b557', 'resource': {'resourceType': 'DiagnosticReport', 'id': ...</msg>
<var>${payload}</var>
<arg>${DATA_SET_PATH_KDSFHIRBUNDLE}/${fhir_bundle_file_name}</arg>
<doc>Load JSON from file.</doc>
<status status="PASS" start="2024-08-28T10:40:57.765078" elapsed="0.002047"/>
</kw>
<kw name="Log To Console" owner="BuiltIn">
<arg>Fhir bundle API call</arg>
<doc>Logs the given message to the console.</doc>
<status status="PASS" start="2024-08-28T10:40:57.767125" elapsed="0.000000"/>
</kw>
<arg>${text}</arg>
<arg>${example_json}</arg>
<status status="PASS" start="2024-08-28T10:40:57.765078" elapsed="0.002047"/>
</kw>
<arg>KDS Biobank</arg>
<arg>kds_biobank_bundle.json</arg>
<status status="PASS" start="2024-08-28T10:40:57.765078" elapsed="0.002047"/>
</kw>
<kw name="validate response - 201" owner="kdsbiobank">
<kw name="Log To Console" owner="BuiltIn">
<arg>In Fhir bundle validate response</arg>
<doc>Logs the given message to the console.</doc>
<status status="PASS" start="2024-08-28T10:40:57.768083" elapsed="0.000995"/>
</kw>
<status status="PASS" start="2024-08-28T10:40:57.768083" elapsed="0.000995"/>
</kw>
<kw name="create openehr aql" owner="kdsbiobank">
<kw name="POST /KDSBiobankBundleAQL with ehr reference" owner="kdsbiobank">
<kw name="Load Json From File" owner="JSONLibrary">
<msg time="2024-08-28T10:40:57.772165" level="INFO">&amp;{resp_ehr} = { _type=COMPOSITION | name={'_type': 'DV_TEXT', 'value': 'KDS_Biobank'} | archetype_details={'archetype_id': {'value': 'openEHR-EHR-COMPOSITION.report.v1'}, 'template_id': {'value': 'KDS_Biobank'}, 'r...</msg>
<var>&amp;{resp_ehr}</var>
<arg>${KDS_BIOBANK_EHR_COMPOSITION}/kds_biobank_canonical.json</arg>
<doc>Load JSON from file.</doc>
<status status="PASS" start="2024-08-28T10:40:57.770078" elapsed="0.002087"/>
</kw>
<kw name="Log To Console" owner="BuiltIn">
<arg>In openEHR AQL API call</arg>
<doc>Logs the given message to the console.</doc>
<status status="PASS" start="2024-08-28T10:40:57.772165" elapsed="0.001023"/>
</kw>
<kw name="Set Suite Variable" owner="BuiltIn">
<msg time="2024-08-28T10:40:57.774179" level="INFO">${response_aql} = {'_type': 'COMPOSITION', 'name': {'_type': 'DV_TEXT', 'value': 'KDS_Biobank'}, 'archetype_details': {'archetype_id': {'value': 'openEHR-EHR-COMPOSITION.report.v1'}, 'template_id': {'value': 'KDS_Bioba...</msg>
<arg>${response_aql}</arg>
<arg>${resp_ehr}</arg>
<doc>Makes a variable available everywhere within the scope of the current suite.</doc>
<status status="PASS" start="2024-08-28T10:40:57.773188" elapsed="0.000991"/>
</kw>
<arg>${openehr_template}</arg>
<status status="PASS" start="2024-08-28T10:40:57.770078" elapsed="0.004101"/>
</kw>
<arg>KDS_Biobank</arg>
<status status="PASS" start="2024-08-28T10:40:57.769078" elapsed="0.005101"/>
</kw>
<kw name="validate content response_aql - 201" owner="kdsbiobank">
<kw name="Get Value From Json" owner="JSONLibrary">
<msg time="2024-08-28T10:40:57.793004" level="INFO">${template_id} = ['KDS_Biobank']</msg>
<var>${template_id}</var>
<arg>${response_aql}</arg>
<arg>$.archetype_details.template_id.value</arg>
<doc>Get Value From JSON using JSONPath</doc>
<status status="PASS" start="2024-08-28T10:40:57.774991" elapsed="0.018013"/>
</kw>
<kw name="Log To Console" owner="BuiltIn">
<arg>In openEHR AQL validate response</arg>
<doc>Logs the given message to the console.</doc>
<status status="PASS" start="2024-08-28T10:40:57.794088" elapsed="0.000000"/>
</kw>
<kw name="Log To Console" owner="BuiltIn">
<arg>The template_id is ${template_id}[0]</arg>
<doc>Logs the given message to the console.</doc>
<status status="PASS" start="2024-08-28T10:40:57.794088" elapsed="0.000000"/>
</kw>
<kw name="Should Be Equal As Strings" owner="BuiltIn">
<arg>${template_id}[0]</arg>
<arg>KDS_Biobank</arg>
<doc>Fails if objects are unequal after converting them to strings.</doc>
<status status="PASS" start="2024-08-28T10:40:57.794999" elapsed="0.000000"/>
</kw>
<status status="PASS" start="2024-08-28T10:40:57.774991" elapsed="0.020008"/>
</kw>
<doc>1. *CREATE* new EHR record

2. *CREATE* FHIR bundle kds_biobank_bundle.json and post it to FHIR server

3. *VALIDATE* the FHIR response status

   4. *CREATE* openEHR AQL and post it to openEHR server

5. *VALIDATE* the content of the AQL response.</doc>
<tag>bundle_create</tag>
<tag>create</tag>
<tag>kds-biobank-fhir-bundle</tag>
<tag>not-implemented</tag>
<tag>not-ready</tag>
<tag>valid</tag>
<status status="PASS" start="2024-08-28T10:40:57.708080" elapsed="0.086919"/>
</test>
<status status="PASS" start="2024-08-28T10:40:57.088313" elapsed="0.707689"/>
</suite>
<statistics>
<total>
<stat pass="1" fail="0" skip="0">All Tests</stat>
</total>
<tag>
<stat pass="1" fail="0" skip="0">bundle_create</stat>
<stat pass="1" fail="0" skip="0">create</stat>
<stat pass="1" fail="0" skip="0">kds-biobank-fhir-bundle</stat>
<stat pass="1" fail="0" skip="0">not-implemented</stat>
<stat pass="1" fail="0" skip="0">not-ready</stat>
<stat pass="1" fail="0" skip="0">valid</stat>
</tag>
<suite>
<stat pass="1" fail="0" skip="0" id="s1" name="01 KDS Biobank">01 KDS Biobank</stat>
</suite>
</statistics>
<errors>
</errors>
</robot>
